<!DOCTYPE html>
<!--
Unity Scene Inspector
===================

This inspector connects to Unity via the BS (BanterScript) library to display real-time scene hierarchy and component data.

Requirements:
1. The BS library must be loaded (typically from dist/bundle.js)
2. Unity must be running with the BS bridge active
3. The scene must have accessible GameObjects

If the BS library integration doesn't work, you may need to:

1. Ensure the BS library is properly injected into Unity:
   - Check that window.BS is available
   - Verify BS.BanterScene.GetInstance() returns a valid scene object
   - Confirm the "unity-loaded" event fires

2. Add additional scene discovery methods:
   - The current implementation looks for common root object names
   - You may need to add custom root object names specific to your scene
   - Consider implementing a scene registration system where objects register themselves

3. Extend component type support:
   - Add more BS.ComponentType checks in the extractComponentData function
   - Map Unity component types to their BS equivalents
   - Handle custom components specific to your project

4. Implement bi-directional updates:
   - Currently read-only, but could add property setters
   - Use BS component methods to update values in Unity
   - Add event listeners for Unity-side changes

5. Handle edge cases:
   - Circular references in the hierarchy
   - Very large scenes (implement pagination/lazy loading)
   - Dynamic object creation/destruction
   - Network-synced objects

The inspector will fall back to mock data if it cannot connect to Unity.
-->
<html lang="en" android-bundle windows-bundle>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Unity Scene Inspector - Resonite Style</title>
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        
        window.isLocalHost = window.location.hostname === 'localhost';
        window.repoUrl = '.'
        window.fileServer = localStorage.getItem('file_server');
        if(window.fileServer === "github"){
            window.repoUrl = 'https://saternius.github.io/BanterInspector'
        }else if(window.fileServer === "local"){
            window.repoUrl = localStorage.getItem('ngrok_url');
        }
        
        window.blockServiceUrl = `${localStorage.getItem('ngrok_url')}/api/process-text`;
        if(window.isLocalHost && window.fileServer === "unity"){
            window.repoUrl = 'http://localhost:42069'
        }

        
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = window.isLocalHost ? './styles.css' : window.repoUrl + '/styles.css';
        document.head.appendChild(link);
      </script>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navigation-header">
        <div class="nav-items">
            <button class="nav-item active" data-page="world-inspector">
                <span class="nav-icon">üåç</span>
                World Inspector
            </button>
            <button class="nav-item" data-page="inventory">
                <span class="nav-icon">üì¶</span>
                Inventory
            </button>
            <button class="nav-item" data-page="feedback">
                <span class="nav-icon">üí¨</span>
                Feedback
            </button>
        </div>
        <div class="nav-controls">
            <button id="undoBtn" class="nav-control-btn" title="Undo (Ctrl+Z)" disabled>
                <span class="control-icon">‚Ü∂</span>
            </button>
            <button id="redoBtn" class="nav-control-btn" title="Redo (Ctrl+Shift+Z)" disabled>
                <span class="control-icon">‚Ü∑</span>
            </button>
            <button id="saveBtn" class="nav-control-btn" title="Save Scene">
                <span class="control-icon">üíæ</span>
            </button>
        </div>
    </nav>

    <!-- Page Container -->
    <div class="page-container">
        <!-- World Inspector Page -->
        <div class="page active" id="world-inspector-page">
            <div class="inspector-container">
        <!-- Hierarchy Panel -->
        <div class="panel hierarchy-panel">
            <div class="panel-header">
                Scene Hierarchy
            </div>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search entities...">
            </div>
            
            <div class="entity-actions-container">
                <button class="action-button" id="addChildEntityBtn" title="Add Child">
                    <span class="button-icon">+</span>
                    
                </button>
                <button class="action-button" id="cloneEntityBtn" title="Clone">
                    <span class="button-icon">üß¨</span>
                   
                </button>
                <button class="action-button delete-button" id="deleteEntityBtn" title="Delete">
                    <span class="button-icon">√ó</span>
                   
                </button>
                <button class="action-button save-button" id="saveEntityBtn" title="Save">
                    <span class="button-icon">üíæ</span>
                   
                </button>
            </div>
            
            <div class="hierarchy-tree" id="hierarchyTree">
                <div class="loading-state">Loading scene hierarchy...</div>
            </div>
        </div>
        
        <!-- Properties Panel -->
        <div class="panel properties-panel" id="propertiesPanel">
            <div class="panel-header">
                <span id="selectedEntityName">Properties</span>
                <button id="collapseAllBtn" class="collapse-all-btn" style="display: none;">Collapse All</button>
            </div>
            
            <div class="properties-content" id="propertiesContent">
                <div class="empty-state">
                    <h3>No entity selected</h3>
                    <p>Select a entity from the hierarchy to view its properties</p>
                </div>
            </div>
            
            <div class="add-component-container" id="addComponentContainer" style="display: none;">
                <button class="add-component-button" id="addComponentBtn">
                    <span>+</span>
                    Add Component
                </button>
            </div>
        </div>
        
        <!-- Space Props Panel Container (Split Horizontally) -->
        <div class="panel space-props-panel-container">
            <!-- Original Space Props Panel -->
            <div class="space-props-panel">
                <div class="panel-header">
                    Space Properties
                    <div class="lifecycle-buttons">
                        <button class="console-clear-button" id="refreshSpacePropsBtn" title="Refresh Panel">üîÑ</button>
                    </div>
                </div>
                
                <div class="properties-content">
                    <!-- Public Properties -->
                    <div class="space-props-section">
                        <div class="space-props-header">
                            <h3>Public Properties</h3>
                            <span class="props-count" id="publicPropsCount">0</span>
                        </div>
                        <div class="props-list" id="publicPropsList">
                            <div class="empty-props">No public properties</div>
                        </div>
                        <div class="add-prop-container">
                            <input type="text" id="addPublicKey" class="prop-input" placeholder="Key">
                            <input type="text" id="addPublicValue" class="prop-input" placeholder="Value">
                            <button onclick="addPublicProp()" class="add-prop-button">Add</button>
                        </div>
                    </div>
                    
                    <!-- Protected Properties -->
                    <div class="space-props-section">
                        <div class="space-props-header">
                            <h3>Protected Properties</h3>
                            <span class="props-count" id="protectedPropsCount">0</span>
                        </div>
                        <div class="props-list" id="protectedPropsList">
                            <div class="empty-props">No protected properties</div>
                        </div>
                        <div class="add-prop-container">
                            <input type="text" id="addProtectedKey" class="prop-input" placeholder="Key">
                            <input type="text" id="addProtectedValue" class="prop-input" placeholder="Value">
                            <button onclick="addProtectedProp()" class="add-prop-button">Add</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Lifecycle Panel -->
            <div class="lifecycle-panel">
                <div class="panel-header">
                    <span>Lifecycle</span>
                    <div class="lifecycle-buttons">
                        <button class="console-clear-button" id="refreshPanelBtn" title="Refresh Panel">üîÑ</button>
                    </div>
                </div>
                
                <div class="lifecycle-content">
                    <!-- MonoBehavior List -->
                    <div class="lifecycle-list" id="lifecycleList">
                        <div class="empty-lifecycle">No active MonoBehavior scripts</div>
                    </div>
                    
                    <!-- Console -->
                    <div class="lifecycle-console-container">
                        <div class="console-header">
                            <span>Console</span>
                            <div class="console-toggles">
                                <button class="console-toggle active" data-toggle="command" title="Command">Command</button>
                                <button class="console-toggle active" data-toggle="script" title="Scripts">Scripts</button>
                                <button class="console-toggle active" data-toggle="oneShot" title="OneShot">OneShot</button>
                                <button class="console-toggle active" data-toggle="spaceProps" title="SpaceProps">SpaceProps</button>
                                <button class="console-clear-button" id="clearConsoleBtn2" title="Clear Console">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="lifecycle-console" id="lifecycleConsole"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Menu Overlay -->
    <div class="component-menu-overlay" id="componentMenuOverlay" style="display: none;">
        <div class="component-menu">
            <div class="component-menu-header">
                <h2>Add Component</h2>
                <button class="close-button" id="closeComponentMenu">√ó</button>
            </div>
            
            <div class="component-menu-search">
                <input type="text" class="component-search-input" id="componentSearchInput" placeholder="Search components...">
            </div>
            
            <div class="component-menu-content">
                
                
                <!-- Meshes Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üé®</span>
                        <span class="category-name">Meshes</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterBox">
                            <span class="component-item-name">Box</span>
                            <span class="component-item-desc">Box mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterSphere">
                            <span class="component-item-name">Sphere</span>
                            <span class="component-item-desc">Sphere mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterCircle">
                            <span class="component-item-name">Circle</span>
                            <span class="component-item-desc">Circle mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterCone">
                            <span class="component-item-name">Cone</span>
                            <span class="component-item-desc">Cone mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterCylinder">
                            <span class="component-item-name">Cylinder</span>
                            <span class="component-item-desc">Cylinder mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterTorus">
                            <span class="component-item-name">Torus</span>
                            <span class="component-item-desc">Torus mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterPlane">
                            <span class="component-item-name">Plane</span>
                            <span class="component-item-desc">Plane mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterRing">
                            <span class="component-item-name">Ring</span>
                            <span class="component-item-desc">Ring mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterGeometry">
                            <span class="component-item-name">Geometry</span>
                            <span class="component-item-desc">3D procedural shapes</span>
                        </div>
                        <div class="component-item" data-component="BanterInvertedMesh">
                            <span class="component-item-name">Inverted Mesh</span>
                            <span class="component-item-desc">Inverted mesh</span>
                        </div>
                        <div class="component-item" data-component="BanterText">
                            <span class="component-item-name">Text</span>
                            <span class="component-item-desc">3D text display</span>
                        </div>
                    </div>
                </div>

                <!-- Materials Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üé®</span>
                        <span class="category-name">Materials</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterMaterial">
                            <span class="component-item-name">Material</span>
                            <span class="component-item-desc">Surface appearance</span>
                        </div>
                        <div class="component-item" data-component="BanterPhysicMaterial">
                            <span class="component-item-name">Physic Material</span>
                            <span class="component-item-desc">Physics material properties</span>
                        </div>
                    </div>
                </div>

                <!-- Physics Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">‚öõ</span>
                        <span class="category-name">Physics</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterRigidbody">
                            <span class="component-item-name">Rigidbody</span>
                            <span class="component-item-desc">Enables physics simulation</span>
                        </div>
                        <div class="component-item" data-component="BoxCollider">
                            <span class="component-item-name">Box Collider</span>
                            <span class="component-item-desc">Box-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="SphereCollider">
                            <span class="component-item-name">Sphere Collider</span>
                            <span class="component-item-desc">Sphere-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="CapsuleCollider">
                            <span class="component-item-name">Capsule Collider</span>
                            <span class="component-item-desc">Capsule-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="MeshCollider">
                            <span class="component-item-name">Mesh Collider</span>
                            <span class="component-item-desc">Mesh-based collision detection</span>
                        </div>
                        <div class="component-item" data-component="ConfigurableJoint">
                            <span class="component-item-name">Configurable Joint</span>
                            <span class="component-item-desc">Configurable joint constraint</span>
                        </div>
                    </div>
                </div>

                <!-- Media Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üé¨</span>
                        <span class="category-name">Media</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterGLTF">
                            <span class="component-item-name">GLTF</span>
                            <span class="component-item-desc">Load 3D models</span>
                        </div>
                        <div class="component-item" data-component="BanterAudioSource">
                            <span class="component-item-name">Audio Source</span>
                            <span class="component-item-desc">Play sounds and music</span>
                        </div>
                        <div class="component-item" data-component="BanterVideoPlayer">
                            <span class="component-item-name">Video Player</span>
                            <span class="component-item-desc">Play video content</span>
                        </div>
                        <div class="component-item" data-component="BanterBillboard">
                            <span class="component-item-name">Billboard</span>
                            <span class="component-item-desc">Always faces camera</span>
                        </div>
                    </div>
                </div>
                
                <!-- Misc Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üì¶</span>
                        <span class="category-name">Misc</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterMirror">
                            <span class="component-item-name">Mirror</span>
                            <span class="component-item-desc">Reflective surface</span>
                        </div>
                        <div class="component-item" data-component="BanterBrowser">
                            <span class="component-item-name">Browser</span>
                            <span class="component-item-desc">Embed web content</span>
                        </div>
                        <div class="component-item" data-component="BanterAssetBundle">
                            <span class="component-item-name">Asset Bundle</span>
                            <span class="component-item-desc">Unity asset bundles</span>
                        </div>
                        <div class="component-item" data-component="BanterWorldObject">
                            <span class="component-item-name">World Object</span>
                            <span class="component-item-desc">World object reference</span>
                        </div>
                        <div class="component-item" data-component="BanterStreetView">
                            <span class="component-item-name">Street View</span>
                            <span class="component-item-desc">Street view panorama</span>
                        </div>
                        <div class="component-item" data-component="BanterKitItem">
                            <span class="component-item-name">Kit Item</span>
                            <span class="component-item-desc">Kit item component</span>
                        </div>
                        <div class="component-item" data-component="BanterPortal">
                            <span class="component-item-name">Portal</span>
                            <span class="component-item-desc">Portal to other spaces</span>
                        </div>
                    </div>
                </div>

                <!-- Behaviors Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">ü§ö</span>
                        <span class="category-name">Behaviors</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterColliderEvents">
                            <span class="component-item-name">Collider Events</span>
                            <span class="component-item-desc">Trigger and collision events</span>
                        </div>
                        <div class="component-item" data-component="BanterAttachedObject">
                            <span class="component-item-name">Attached Object</span>
                            <span class="component-item-desc">Attach to users</span>
                        </div>
                        <div class="component-item" data-component="BanterSyncedObject">
                            <span class="component-item-name">Synced Object</span>
                            <span class="component-item-desc">Network synchronization</span>
                        </div>
                        <div class="component-item" data-component="BanterGrabHandle">
                            <span class="component-item-name">Grab Handle</span>
                            <span class="component-item-desc">Make object grabbable</span>
                        </div>
                        <div class="component-item" data-component="BanterHeldEvents">
                            <span class="component-item-name">Held Events</span>
                            <span class="component-item-desc">Input while holding</span>
                        </div>
                        <div class="component-item" data-component="MonoBehavior">
                            <span class="component-item-name">MonoBehavior</span>
                            <span class="component-item-desc">Add a MonoBehavior script</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div> <!-- End World Inspector Page -->

        <!-- Inventory Page -->
        <div class="page" id="inventory-page">
            <div class="inventory-layout">
                <div class="inventory-container">
                    <!-- Inventory content will go here -->
                </div>
                <div class="inventory-preview-pane" id="previewPane" style="display: none;">
                    <!-- Preview content will go here -->
                </div>
            </div>
        </div>

        <!-- Feedback Page -->
        <div class="page" id="feedback-page">
            <div class="feedback-split-layout">
                <!-- Left Side - Feedback Form -->
                <div class="feedback-left-panel">
                    <div class="feedback-container">
                        <div class="feedback-header">
                            <h2>Help Improve the Inspector</h2>
                            <p>Your feedback helps us make the inspector better for everyone</p>
                        </div>
                        
                        <div class="feedback-form">
                            <div class="feedback-section">
                                <label class="feedback-label">What would you like to share?</label>
                                <div class="feedback-type-selector">
                                    <button class="feedback-type-btn active" data-type="feature">
                                        <span class="feedback-type-icon">‚ú®</span>
                                        Feature
                                    </button>
                                    <button class="feedback-type-btn" data-type="bug">
                                        <span class="feedback-type-icon">üêõ</span>
                                        Bug 
                                    </button>
                                    <button class="feedback-type-btn" data-type="improvement">
                                        <span class="feedback-type-icon">üí°</span>
                                        Idea
                                    </button>
                                </div>
                            </div>
                            
                            <div class="feedback-section">
                                <label class="feedback-label" for="feedbackDetails">Your Feedback</label>
                                <div class="feedback-input feedback-input-container">
                                    <textarea id="feedbackDetails" class="feedback-textarea" rows="6" placeholder="Please provide as much detail as possible..."></textarea>
                                    <button id="micButton" class="mic-button" title="Click to record feedback">
                                        <span class="mic-icon">üé§</span>
                                        <span class="recording-indicator"></span>
                                    </button>
                                </div>
                                <div id="speechStatus" class="speech-status" style="display: none;"></div>
                                
                                <!-- Block Editor Container -->
                                <div id="blockEditorContainer" class="block-editor-container" style="display: none;">
                                    <div class="block-editor-header">
                                        <h3>Refined Feedback</h3>
                                        <button id="clearDraftBtn" class="clear-draft-btn" title="Clear draft and start over" style="display: none;">
                                            <span class="btn-icon">üóëÔ∏è</span>
                                            Clear Draft
                                        </button>
                                    </div>
                                    <div class="block-editor-content">
                                        <div id="blocksList" class="blocks-list">
                                            <!-- Blocks will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="feedback-actions">
                                <button id="submitFeedbackBtn" class="feedback-submit-btn">
                                    <span class="btn-icon">üì§</span>
                                    Submit Feedback
                                </button>
                                <div id="dualSubmitButtons" class="dual-submit-buttons" style="display: none;">
                                    <button id="submitOriginalBtn" class="feedback-submit-btn submit-original">
                                        <span class="btn-icon">üìÑ</span>
                                        Submit Original
                                    </button>
                                    <button id="submitRefinementBtn" class="feedback-submit-btn submit-original">
                                        <span class="btn-icon">‚ú®</span>
                                        Submit Refinement
                                    </button>
                                </div>
                            </div>
                            
                            <div id="feedbackStatus" class="feedback-status" style="display: none;"></div>
                        </div>
                        
                        <div class="feedback-footer">
                            <p>You can also contribute directly on <a href="https://github.com/saternius/BanterInspector" target="_blank">GitHub</a></p>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side - Tickets List -->
                <div class="feedback-right-panel">
                    <div class="tickets-container">
                        <div class="tickets-header">
                            <h2>Active Tickets</h2>
                            <button id="refreshTicketsBtn" class="refresh-tickets-btn" title="Refresh tickets">
                                <span class="btn-icon">üîÑ</span>
                            </button>
                        </div>
                        
                        <div class="tickets-filters">
                            <select id="ticketFilterType" class="ticket-filter">
                                <option value="all">All Types</option>
                                <option value="feature">Features</option>
                                <option value="bug">Bugs</option>
                                <option value="improvement">Improvements</option>
                            </select>
                            <select id="ticketFilterStatus" class="ticket-filter">
                                <option value="all">All Status</option>
                                <option value="open">Open</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        
                        <div id="ticketsList" class="tickets-list">
                            <div class="loading-tickets">Loading tickets...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ticket Detail Modal -->
            <div id="ticketDetailModal" class="ticket-detail-modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTicketId"></h3>
                        <button class="modal-close" onclick="closeTicketModal()">√ó</button>
                    </div>
                    <div id="modalTicketContent" class="modal-body"></div>
                </div>
            </div>
            
            <!-- Ticket Edit Modal -->
            <div id="ticketEditModal" class="ticket-edit-modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Feedback</h3>
                        <button class="modal-close" onclick="feedback.closeEditModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="edit-form-group">
                            <label for="ticketEditContent">Feedback Details:</label>
                            <textarea id="ticketEditContent" class="ticket-edit-textarea" rows="8" placeholder="Enter your feedback details..."></textarea>
                        </div>
                        <div class="modal-actions">
                            <button class="modal-save-btn" onclick="feedback.saveTicketEdit()">Save Changes</button>
                            <button class="modal-cancel-btn" onclick="feedback.closeEditModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="file-server" id="fileServer" onclick="SM.toggleFileServer()">File Server</div>
    </div> <!-- End Page Container -->

    <!-- Load JavaScript modules -->
    <script>
        const script = document.createElement('script');
        script.type = 'module';
        script.src = window.isLocalHost ? './js/app.js' : window.repoUrl + '/js/app.js';
    
        window.repoUrl += "/js"
        console.log("window.repoUrl", window.repoUrl)
        document.body.appendChild(script);
        
        // Add debug script for testing (only in local development)
        if (window.isLocalHost) {
            setTimeout(() => {
                const debugScript = document.createElement('script');
                debugScript.src = './debug-history.js';
                document.body.appendChild(debugScript);
            }, 1000);
        }
    </script>
    
</body>
</html>