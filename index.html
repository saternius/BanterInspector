<!DOCTYPE html>
<!--
Unity Scene Inspector
===================

This inspector connects to Unity via the BS (BanterScript) library to display real-time scene hierarchy and component data.

Requirements:
1. The BS library must be loaded (typically from dist/bundle.js)
2. Unity must be running with the BS bridge active
3. The scene must have accessible GameObjects

If the BS library integration doesn't work, you may need to:

1. Ensure the BS library is properly injected into Unity:
   - Check that window.BS is available
   - Verify BS.BanterScene.GetInstance() returns a valid scene object
   - Confirm the "unity-loaded" event fires

2. Add additional scene discovery methods:
   - The current implementation looks for common root object names
   - You may need to add custom root object names specific to your scene
   - Consider implementing a scene registration system where objects register themselves

3. Extend component type support:
   - Add more BS.ComponentType checks in the extractComponentData function
   - Map Unity component types to their BS equivalents
   - Handle custom components specific to your project

4. Implement bi-directional updates:
   - Currently read-only, but could add property setters
   - Use BS component methods to update values in Unity
   - Add event listeners for Unity-side changes

5. Handle edge cases:
   - Circular references in the hierarchy
   - Very large scenes (implement pagination/lazy loading)
   - Dynamic object creation/destruction
   - Network-synced objects

The inspector will fall back to mock data if it cannot connect to Unity.
-->
<html lang="en" android-bundle windows-bundle>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Unity Scene Inspector - Resonite Style</title>
    <script>
        const isLocal = window.location.hostname === 'localhost';
        window.repoUrl = 'https://saternius.github.io/BanterInspector'
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = isLocal ? './styles.css' : window.repoUrl + '/styles.css';
        document.head.appendChild(link);
      </script>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navigation-header">
        <div class="nav-items">
            <button class="nav-item active" data-page="world-inspector">
                <span class="nav-icon">üåç</span>
                World Inspector
            </button>
            <button class="nav-item" data-page="inventory">
                <span class="nav-icon">üì¶</span>
                Inventory
            </button>
        </div>
        <div class="nav-controls">
            <button id="undoBtn" class="nav-control-btn" title="Undo (Ctrl+Z)" disabled>
                <span class="control-icon">‚Ü∂</span>
            </button>
            <button id="redoBtn" class="nav-control-btn" title="Redo (Ctrl+Shift+Z)" disabled>
                <span class="control-icon">‚Ü∑</span>
            </button>
        </div>
    </nav>

    <!-- Page Container -->
    <div class="page-container">
        <!-- World Inspector Page -->
        <div class="page active" id="world-inspector-page">
            <div class="inspector-container">
        <!-- Hierarchy Panel -->
        <div class="panel hierarchy-panel">
            <div class="panel-header">
                Scene Hierarchy
            </div>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search slots...">
            </div>
            
            <div class="slot-actions-container">
                <button class="action-button" id="addChildSlotBtn" title="Add Child">
                    <span class="button-icon">+</span>
                    
                </button>
                <button class="action-button" id="cloneSlotBtn" title="Clone">
                    <span class="button-icon">üß¨</span>
                   
                </button>
                <button class="action-button delete-button" id="deleteSlotBtn" title="Delete">
                    <span class="button-icon">√ó</span>
                   
                </button>
                <button class="action-button save-button" id="saveSlotBtn" title="Save">
                    <span class="button-icon">üíæ</span>
                   
                </button>
            </div>
            
            <div class="hierarchy-tree" id="hierarchyTree">
                <div class="loading-state">Loading scene hierarchy...</div>
            </div>
        </div>
        
        <!-- Properties Panel -->
        <div class="panel properties-panel">
            <div class="panel-header">
                <span id="selectedSlotName">Properties</span>
            </div>
            
            <div class="properties-content" id="propertiesContent">
                <div class="empty-state">
                    <h3>No slot selected</h3>
                    <p>Select a slot from the hierarchy to view its properties</p>
                </div>
            </div>
            
            <div class="add-component-container" id="addComponentContainer" style="display: none;">
                <button class="add-component-button" id="addComponentBtn">
                    <span>+</span>
                    Add Component
                </button>
            </div>
        </div>
        
        <!-- Space Props Panel Container (Split Horizontally) -->
        <div class="panel space-props-panel-container">
            <!-- Original Space Props Panel -->
            <div class="space-props-panel">
                <div class="panel-header">
                    Space Properties
                    <div class="lifecycle-buttons">
                        <button class="console-clear-button" id="refreshSpacePropsBtn" title="Refresh Panel">üîÑ</button>
                    </div>
                </div>
                
                <div class="properties-content">
                    <!-- Public Properties -->
                    <div class="space-props-section">
                        <div class="space-props-header">
                            <h3>Public Properties</h3>
                            <span class="props-count" id="publicPropsCount">0</span>
                        </div>
                        <div class="props-list" id="publicPropsList">
                            <div class="empty-props">No public properties</div>
                        </div>
                        <div class="add-prop-container">
                            <input type="text" id="addPublicKey" class="prop-input" placeholder="Key">
                            <input type="text" id="addPublicValue" class="prop-input" placeholder="Value">
                            <button onclick="addPublicProp()" class="add-prop-button">Add</button>
                        </div>
                    </div>
                    
                    <!-- Protected Properties -->
                    <div class="space-props-section">
                        <div class="space-props-header">
                            <h3>Protected Properties</h3>
                            <span class="props-count" id="protectedPropsCount">0</span>
                        </div>
                        <div class="props-list" id="protectedPropsList">
                            <div class="empty-props">No protected properties</div>
                        </div>
                        <div class="add-prop-container">
                            <input type="text" id="addProtectedKey" class="prop-input" placeholder="Key">
                            <input type="text" id="addProtectedValue" class="prop-input" placeholder="Value">
                            <button onclick="addProtectedProp()" class="add-prop-button">Add</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Lifecycle Panel -->
            <div class="lifecycle-panel">
                <div class="panel-header">
                    <span>Lifecycle</span>
                    <div class="lifecycle-buttons">
                        <button class="console-clear-button" id="clearConsoleBtn" title="Clear Console">üóëÔ∏è</button>
                        <button class="console-clear-button" id="refreshPanelBtn" title="Refresh Panel">üîÑ</button>
                    </div>
                </div>
                
                <div class="lifecycle-content">
                    <!-- MonoBehavior List -->
                    <div class="lifecycle-list" id="lifecycleList">
                        <div class="empty-lifecycle">No active MonoBehavior scripts</div>
                    </div>
                    
                    <!-- Console -->
                    <div class="lifecycle-console-container">
                        <div class="console-header">Console</div>
                        <div class="lifecycle-console" id="lifecycleConsole"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Menu Overlay -->
    <div class="component-menu-overlay" id="componentMenuOverlay" style="display: none;">
        <div class="component-menu">
            <div class="component-menu-header">
                <h2>Add Component</h2>
                <button class="close-button" id="closeComponentMenu">√ó</button>
            </div>
            
            <div class="component-menu-search">
                <input type="text" class="component-search-input" id="componentSearchInput" placeholder="Search components...">
            </div>
            
            <div class="component-menu-content">
                <!-- Physics Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">‚öõ</span>
                        <span class="category-name">Physics</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterRigidbody">
                            <span class="component-item-name">Rigidbody</span>
                            <span class="component-item-desc">Enables physics simulation</span>
                        </div>
                        <div class="component-item" data-component="BoxCollider">
                            <span class="component-item-name">Box Collider</span>
                            <span class="component-item-desc">Box-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="SphereCollider">
                            <span class="component-item-name">Sphere Collider</span>
                            <span class="component-item-desc">Sphere-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="CapsuleCollider">
                            <span class="component-item-name">Capsule Collider</span>
                            <span class="component-item-desc">Capsule-shaped collision detection</span>
                        </div>
                        <div class="component-item" data-component="MeshCollider">
                            <span class="component-item-name">Mesh Collider</span>
                            <span class="component-item-desc">Mesh-based collision detection</span>
                        </div>
                    </div>
                </div>
                
                <!-- Rendering Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üé®</span>
                        <span class="category-name">Rendering</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterGeometry">
                            <span class="component-item-name">Geometry</span>
                            <span class="component-item-desc">3D procedural shapes</span>
                        </div>
                        <div class="component-item" data-component="BanterMaterial">
                            <span class="component-item-name">Material</span>
                            <span class="component-item-desc">Surface appearance</span>
                        </div>
                        <div class="component-item" data-component="BanterText">
                            <span class="component-item-name">Text</span>
                            <span class="component-item-desc">3D text display</span>
                        </div>
                        <div class="component-item" data-component="BanterBillboard">
                            <span class="component-item-name">Billboard</span>
                            <span class="component-item-desc">Always faces camera</span>
                        </div>
                        <div class="component-item" data-component="BanterMirror">
                            <span class="component-item-name">Mirror</span>
                            <span class="component-item-desc">Reflective surface</span>
                        </div>
                    </div>
                </div>
                
                <!-- Media Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üé¨</span>
                        <span class="category-name">Media</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterAudioSource">
                            <span class="component-item-name">Audio Source</span>
                            <span class="component-item-desc">Play sounds and music</span>
                        </div>
                        <div class="component-item" data-component="BanterVideoPlayer">
                            <span class="component-item-name">Video Player</span>
                            <span class="component-item-desc">Play video content</span>
                        </div>
                        <div class="component-item" data-component="BanterBrowser">
                            <span class="component-item-name">Web Browser</span>
                            <span class="component-item-desc">Embed web content</span>
                        </div>
                    </div>
                </div>
                
                <!-- Interaction Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">ü§ö</span>
                        <span class="category-name">Interaction</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterGrabHandle">
                            <span class="component-item-name">Grab Handle</span>
                            <span class="component-item-desc">Make object grabbable</span>
                        </div>
                        <div class="component-item" data-component="BanterHeldEvents">
                            <span class="component-item-name">Held Events</span>
                            <span class="component-item-desc">Input while holding</span>
                        </div>
                        <div class="component-item" data-component="BanterAttachedObject">
                            <span class="component-item-name">Attached Object</span>
                            <span class="component-item-desc">Attach to users</span>
                        </div>
                        <div class="component-item" data-component="BanterSyncedObject">
                            <span class="component-item-name">Synced Object</span>
                            <span class="component-item-desc">Network synchronization</span>
                        </div>
                    </div>
                </div>
                
                <!-- Loading Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üì¶</span>
                        <span class="category-name">Loading</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="BanterGLTF">
                            <span class="component-item-name">GLTF Model</span>
                            <span class="component-item-desc">Load 3D models</span>
                        </div>
                        <div class="component-item" data-component="BanterAssetBundle">
                            <span class="component-item-name">Asset Bundle</span>
                            <span class="component-item-desc">Unity asset bundles</span>
                        </div>
                        <div class="component-item" data-component="BanterPortal">
                            <span class="component-item-name">Portal</span>
                            <span class="component-item-desc">Portal to other spaces</span>
                        </div>
                    </div>
                </div>


                <!-- Script Category -->
                <div class="component-category">
                    <div class="category-header">
                        <span class="category-icon">üìú</span>
                        <span class="category-name">Script</span>
                    </div>
                    <div class="category-items">
                        <div class="component-item" data-component="MonoBehavior">
                            <span class="component-item-name">MonoBehavior</span>
                            <span class="component-item-desc">Add a MonoBehavior script</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div> <!-- End World Inspector Page -->

        <!-- Inventory Page -->
        <div class="page" id="inventory-page">
            <div class="inventory-layout">
                <div class="inventory-container">
                    <!-- Inventory content will go here -->
                </div>
                <div class="inventory-preview-pane" id="previewPane" style="display: none;">
                    <!-- Preview content will go here -->
                </div>
            </div>
        </div>
    </div> <!-- End Page Container -->

    <!-- Load JavaScript modules -->
    <script>
        const script = document.createElement('script');
        script.type = 'module';
        script.src = isLocal ? './js/app.js' : window.repoUrl + '/js/app.js';
        document.body.appendChild(script);
        
        // Add debug script for testing (only in local development)
        if (isLocal) {
            setTimeout(() => {
                const debugScript = document.createElement('script');
                debugScript.src = './debug-history.js';
                document.body.appendChild(debugScript);
            }, 1000);
        }
    </script>
    
</body>
</html>